# Copyright (C) 2013-2014 Freescale Semiconductor, Inc.
#
# See file CREDITS for list of people who contributed to this
# project.
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License as
# published by the Free Software Foundation; either version 2 of
# the License or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not write to the Free Software
# Foundation Inc. 51 Franklin Street Fifth Floor Boston,
# MA 02110-1301 USA
#
# Refer docs/README.d4400image for more details about how-to configure
# and create d4400image boot image
#
# The syntax is taken as close as possible with the imximage

# NOTE: The BOOT_FROM command is obsolete.  Use the define
# CONFIG_BOOT_FROM in the d4400_evb.h file to specify source
# of boot.
#
# Boot Device : one of
# nor, qspi, eth, or sdp
#BOOT_FROM          nor

# Device Configuration Data (DCD)
#
# Each entry must have the format:
# Addr-type           Address        Value
#
# where:
#	Addr-type register length (1,2 or 4 bytes)
#	Address	  absolute address of the register
#	value	  value to be stored in the register

#===============================================================
#
# PLL configuration
#
#;---------------------------------
#;Configuring Clock dividers to
#;---------------------------------
#;ARM_DIV     0x1
#;VSP_DIV     0x1
#;AXI_DIX     0x0
#;AHB_DIV     0x1
#;IP_DIV      0x1
#;WEIM_DIV    0xb
#;PLL_SYS_DIV 0x0
#;MMDC_DIV    0x2
#;---------------------------------
DATA 0x4   0x01094008	0x20b05011
#;---------------------------------
#;Configuring Clock source selection register
#;---------------------------------
DATA 0x4   0x01094000	0x90020000
#;---------------------------------------------------------
#;Disabling Bypass clock and system_clock select to pll_sys
#;---------------------------------------------------------
DATA 0x4   0x01094004	0x00000001

#===============================================================
#
# MMDC configuration
# Two DDR3L Micron MT41K256M16HA-125E 4Gb devices
# DDR Clock = 491.52 MHz (derived from CPRI 122.88 MHz)
#             tck = 2.035 nSecs
# Refresh Rate = 8192 cycles every 64 mS (up to 85C)
#                1 Refresh cycle every 7.8 uS (3840 clks)
#                Using 3836 clks instead in case of slower clock
#;---------------------------------------------------------------
#; MMDC Configurations Starts here
#;---------------------------------------------------------------
DATA 0x4   0x01080000	0x04190000 # MMDC Core Control
DATA 0x4   0x010808B8	0x00000800 # MMDC Phy Measure Unit
DATA 0x4   0x0108000C	0xD0DA7ff4 # MMDC Core Timing Config 0
DATA 0x4   0x01080010	0xdb730e64 # MMDC Core Timing Config 1
DATA 0x4   0x01080014	0x01ff00db # MMDC Core Timing Config 2
DATA 0x4   0x0108002C	0x00002000 # MMDC Core Read/Write Cmd Dly
DATA 0x4   0x01080030	0x00DA0e21 # MMDC Core Out Of Reset Dlys
DATA 0x4   0x01080040	0x0000007F # MMDC Core Address Space Part
DATA 0x4   0x01080008	0x12444000 # MMDC Core ODT Timing Control
DATA 0x4   0x01080004	0x00030036 # MMDC Core Power Down Control
DATA 0x4   0x01080018	0x00000680 # MMDC Core Miscellaneous
DATA 0x4   0x01080000	0x84190000 # MMDC Core Control
DATA 0x4   0x0108001C	0x02088032 # MR2=0208, CLwrite = 6 ck
DATA 0x4   0x0108001C	0x00008033 # MR3=0000
DATA 0x4   0x0108001C	0x00048031 # MR1=0004, ODS=40ohm, Rtt=60ohm
DATA 0x4   0x0108001C	0x19308830 # MR0=1930, CL = 7
DATA 0x4   0x0108001C	0x04008040 # ZQCL (ZQ Calibration Long)
DATA 0x4   0x01080800	0xa1390003 # MMDC PHY ZQ HW Control
DATA 0x4   0x01080020	0x0EFC8000 # MMDC Core Refresh Control
DATA 0x4   0x01080818	0x0002222f # MMDC PHY ODT Control
# disable auto refreshes
DATA 0x4   0x01080020	0x0EFCC000 # MMDC Refresh Control
# Manual Refresh Command
DATA 0x4   0x0108001C	0x00008020 # REF (Refresh)
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000

## Write Leveling Calibration
DATA 0x4   0x0108001C	0x00848031 # MR1=0084, Enable WL
DATA 0x4   0x0108001C	0x00008200 # DQS dir for Write Leveling
# HW_WL_EN  1
DATA 0x4   0x01080808	0x00000001 # MMDC PHY Write Leveling Cfg
# wait for calibration to complete
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
# WL Disable in MR1
DATA 0x4   0x0108001C	0x00048031 # MR1=0004, Disable WL
DATA 0x4   0x0108001C	0x00008000 # DQS dir normal
## Manual refresh command
DATA 0x4   0x0108001C	0x00008020 # REF (Refresh)
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000

## Read DQS Gating Calibration
# Precharge All active bank command
DATA 0x4   0x0108001C	0x04008050 # PREA (Precharge All)
# MPR command
DATA 0x4   0x0108001C	0x00048033 # MR3=0004, Stream MPR pattern
# MPR Configure to Controller
DATA 0x4   0x01080890	0x00000001 # MMDC PHY Compare & CA Line Cfg
# MPDGCTRL0[HW_DG_EN]
DATA 0x4   0x0108083C	0x10000000 # MMDC PHY Read DQS Gating Control
# wait for calibration to complete
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
# Manual refresh command
DATA 0x4   0x0108001C	0x00008020 # REF (Refresh)
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000

## Read Calibration Started
# clear MRS in MR3
DATA 0x4   0x0108001C	0x00008033 # MR3=0000, Normal DRAM operation
# Precharge All active bank command
DATA 0x4   0x0108001C	0x04008050 # PREA (Precharcge All)
# MPR command
DATA 0x4   0x0108001C	0x00048033 # MR3=0004, Stream MPR pattern
# MPR Configure to Controller
DATA 0x4   0x01080890	0x00000001 # MMDC PHY Compare & CA Line Cfg
# Start Read Calibration
DATA 0x4   0x01080860	0x00000010 # MMDC PHY Read Delay HW Calibration
# wait for calibration to complete
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000
DATA 0x4   0x04084010	0x00000000

# clear MRS in MR3
DATA 0x4   0x0108001C	0x00008033 # MR3=0000, Normal DRAM operation
DATA 0x4   0x01080020	0x0EFC8000 # MMDC Core Refresh Control
DATA 0x4   0x0108001C	0x00000000 # Normal operation
#;*======================================================================
#; Micron_DDR_Config Script ends here
#;*======================================================================
